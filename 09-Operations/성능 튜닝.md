# ì„±ëŠ¥ íŠœë‹

## ğŸ¯ ê°œìš”

ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì „ë°˜ì ì¸ ì„±ëŠ¥ ìµœì í™” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤. ì»¨íŠ¸ë¡¤ í”Œë ˆì¸, ì›Œì»¤ ë…¸ë“œ, ë„¤íŠ¸ì›Œí¬, ìŠ¤í† ë¦¬ì§€, ê·¸ë¦¬ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œì˜ íŠœë‹ ì „ëµê³¼ ì‹¤ì „ ê¸°ë²•ì„ í¬í•¨í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì„±ëŠ¥ íŠœë‹

### etcd ìµœì í™”

```bash
#!/bin/bash
# etcd-optimization.sh

# etcd ì„±ëŠ¥ ì„¤ì • ìµœì í™”
optimize_etcd_configuration() {
    echo "Optimizing etcd configuration..."
    
    # etcd ì„¤ì • íŒŒì¼ ìˆ˜ì •
    cat > /etc/kubernetes/manifests/etcd-optimization.yaml << 'EOF'
apiVersion: v1
kind: Pod
metadata:
  annotations:
    kubeadm.kubernetes.io/etcd.advertise-client-urls: https://192.168.1.10:2379
  labels:
    component: etcd
    tier: control-plane
  name: etcd
  namespace: kube-system
spec:
  containers:
  - command:
    - etcd
    - --advertise-client-urls=https://192.168.1.10:2379
    - --cert-file=/etc/kubernetes/pki/etcd/server.crt
    - --client-cert-auth=true
    - --data-dir=/var/lib/etcd
    - --initial-advertise-peer-urls=https://192.168.1.10:2380
    - --initial-cluster=master=https://192.168.1.10:2380
    - --key-file=/etc/kubernetes/pki/etcd/server.key
    - --listen-client-urls=https://127.0.0.1:2379,https://192.168.1.10:2379
    - --listen-metrics-urls=http://127.0.0.1:2381
    - --listen-peer-urls=https://192.168.1.10:2380
    - --name=master
    - --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt
    - --peer-client-cert-auth=true
    - --peer-key-file=/etc/kubernetes/pki/etcd/peer.key
    - --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt
    - --snapshot-count=10000
    - --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt
    # ì„±ëŠ¥ ìµœì í™” íŒŒë¼ë¯¸í„°
    - --heartbeat-interval=100
    - --election-timeout=1000
    - --max-snapshots=5
    - --max-wals=5
    - --quota-backend-bytes=8589934592  # 8GB
    - --auto-compaction-retention=1h
    - --auto-compaction-mode=periodic
EOF

    echo "etcd configuration optimized"
}

# etcd ì••ì¶• ë° ì¡°ê° ëª¨ìŒ
defragment_etcd() {
    echo "Defragmenting etcd..."
    
    # etcd ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
    ETCDCTL_API=3 etcdctl \
        --endpoints=https://127.0.0.1:2379 \
        --cacert=/etc/kubernetes/pki/etcd/ca.crt \
        --cert=/etc/kubernetes/pki/etcd/server.crt \
        --key=/etc/kubernetes/pki/etcd/server.key \
        endpoint status --write-out=table
    
    # ì••ì¶• ì‹¤í–‰
    ETCDCTL_API=3 etcdctl \
        --endpoints=https://127.0.0.1:2379 \
        --cacert=/etc/kubernetes/pki/etcd/ca.crt \
        --cert=/etc/kubernetes/pki/etcd/server.crt \
        --key=/etc/kubernetes/pki/etcd/server.key \
        compact $(ETCDCTL_API=3 etcdctl \
            --endpoints=https://127.0.0.1:2379 \
            --cacert=/etc/kubernetes/pki/etcd/ca.crt \
            --cert=/etc/kubernetes/pki/etcd/server.crt \
            --key=/etc/kubernetes/pki/etcd/server.key \
            endpoint status --write-out="json" | jq '.[0].Status.header.revision')
    
    # ì¡°ê° ëª¨ìŒ ì‹¤í–‰
    ETCDCTL_API=3 etcdctl \
        --endpoints=https://127.0.0.1:2379 \
        --cacert=/etc/kubernetes/pki/etcd/ca.crt \
        --cert=/etc/kubernetes/pki/etcd/server.crt \
        --key=/etc/kubernetes/pki/etcd/server.key \
        defrag
    
    echo "etcd defragmentation completed"
}

# etcd ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
monitor_etcd_performance() {
    echo "=== etcd Performance Metrics ==="
    
    # etcd ìƒíƒœ í™•ì¸
    ETCDCTL_API=3 etcdctl \
        --endpoints=https://127.0.0.1:2379 \
        --cacert=/etc/kubernetes/pki/etcd/ca.crt \
        --cert=/etc/kubernetes/pki/etcd/server.crt \
        --key=/etc/kubernetes/pki/etcd/server.key \
        endpoint status --write-out=table
    
    # etcd ë©”íŠ¸ë¦­ í™•ì¸
    curl -s http://127.0.0.1:2381/metrics | grep -E "(etcd_server_proposals|etcd_disk_wal_fsync|etcd_disk_backend_commit)"
}

optimize_etcd_configuration
defragment_etcd
monitor_etcd_performance
```

### API Server ìµœì í™”

```yaml
# apiserver-optimization.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    component: kube-apiserver
    tier: control-plane
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    - --advertise-address=192.168.1.10
    - --allow-privileged=true
    - --authorization-mode=Node,RBAC
    - --client-ca-file=/etc/kubernetes/pki/ca.crt
    - --enable-admission-plugins=NodeRestriction
    - --enable-bootstrap-token-auth=true
    - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt
    - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt
    - --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key
    - --etcd-servers=https://127.0.0.1:2379
    - --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt
    - --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key
    - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
    - --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt
    - --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key
    - --requestheader-allowed-names=front-proxy-client
    - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt
    - --requestheader-extra-headers-prefix=X-Remote-Extra-
    - --requestheader-group-headers=X-Remote-Group
    - --requestheader-username-headers=X-Remote-User
    - --secure-port=6443
    - --service-account-issuer=https://kubernetes.default.svc.cluster.local
    - --service-account-key-file=/etc/kubernetes/pki/sa.pub
    - --service-account-signing-key-file=/etc/kubernetes/pki/sa.key
    - --service-cluster-ip-range=10.96.0.0/12
    - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt
    - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key
    # ì„±ëŠ¥ ìµœì í™” íŒŒë¼ë¯¸í„°
    - --max-requests-inflight=400
    - --max-mutating-requests-inflight=200
    - --default-watch-cache-size=1000
    - --watch-cache-sizes=nodes#1000,pods#5000
    - --enable-aggregator-routing=true
    - --request-timeout=60s
    - --min-request-timeout=1800
    # ì´ë²¤íŠ¸ TTL ì„¤ì •
    - --event-ttl=24h
    # ê°ì‚¬ ë¡œê·¸ ìµœì í™”
    - --audit-log-maxage=7
    - --audit-log-maxbackup=3
    - --audit-log-maxsize=100
    # ì••ì¶• í™œì„±í™”
    - --enable-gzip=true
    image: k8s.gcr.io/kube-apiserver:v1.28.0
    imagePullPolicy: IfNotPresent
    name: kube-apiserver
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
```

## ğŸ–¥ï¸ ë…¸ë“œ ë ˆë²¨ ìµœì í™”

### ì‹œìŠ¤í…œ ì»¤ë„ íŒŒë¼ë¯¸í„° íŠœë‹

```bash
#!/bin/bash
# system-optimization.sh

# ì»¤ë„ íŒŒë¼ë¯¸í„° ìµœì í™”
optimize_kernel_parameters() {
    echo "Optimizing kernel parameters..."
    
    cat > /etc/sysctl.d/99-kubernetes-performance.conf << 'EOF'
# ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™”
net.core.netdev_max_backlog = 5000
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 65536 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216
net.ipv4.tcp_congestion_control = bbr
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_tw_reuse = 1

# íŒŒì¼ ì‹œìŠ¤í…œ ìµœì í™”
fs.file-max = 2097152
fs.inotify.max_user_instances = 512
fs.inotify.max_user_watches = 524288
fs.nr_open = 1048576

# ë©”ëª¨ë¦¬ ê´€ë¦¬ ìµœì í™”
vm.swappiness = 1
vm.dirty_background_ratio = 5
vm.dirty_ratio = 10
vm.vfs_cache_pressure = 50
vm.max_map_count = 262144

# í”„ë¡œì„¸ìŠ¤ ë° ìŠ¤ë ˆë“œ ìµœì í™”
kernel.pid_max = 4194304
kernel.threads-max = 1048576

# ì»¤ë„ ìŠ¤ì¼€ì¤„ëŸ¬ ìµœì í™”
kernel.sched_migration_cost_ns = 5000000
kernel.sched_autogroup_enabled = 0
EOF

    # ì„¤ì • ì ìš©
    sysctl -p /etc/sysctl.d/99-kubernetes-performance.conf
    
    echo "Kernel parameters optimized"
}

# ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
configure_system_limits() {
    echo "Configuring system limits..."
    
    cat > /etc/security/limits.d/99-kubernetes.conf << 'EOF'
# Kubernetes ë…¸ë“œìš© ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
* soft nofile 1048576
* hard nofile 1048576
* soft nproc 1048576
* hard nproc 1048576
* soft core unlimited
* hard core unlimited
* soft memlock unlimited
* hard memlock unlimited

root soft nofile 1048576
root hard nofile 1048576
root soft nproc 1048576
root hard nproc 1048576
EOF

    # systemd ì„œë¹„ìŠ¤ ì œí•œ ì„¤ì •
    mkdir -p /etc/systemd/system/kubelet.service.d
    cat > /etc/systemd/system/kubelet.service.d/20-limits.conf << 'EOF'
[Service]
LimitNOFILE=1048576
LimitNPROC=1048576
LimitMEMLOCK=infinity
EOF

    systemctl daemon-reload
    
    echo "System limits configured"
}

# CPU ê±°ë²„ë„ˆ ë° ì„±ëŠ¥ ì„¤ì •
optimize_cpu_performance() {
    echo "Optimizing CPU performance..."
    
    # CPU ê±°ë²„ë„ˆë¥¼ performance ëª¨ë“œë¡œ ì„¤ì •
    for cpu in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do
        if [ -f "$cpu" ]; then
            echo performance > "$cpu"
        fi
    done
    
    # CPU ì ˆì „ ê¸°ëŠ¥ ë¹„í™œì„±í™”
    for cpu in /sys/devices/system/cpu/cpu*/cpuidle/state*/disable; do
        if [ -f "$cpu" ]; then
            echo 1 > "$cpu"
        fi
    done
    
    # NUMA ë°¸ëŸ°ì‹± ë¹„í™œì„±í™” (ë‹¨ì¼ NUMA ë…¸ë“œê°€ ì•„ë‹Œ ê²½ìš°)
    echo 0 > /proc/sys/kernel/numa_balancing
    
    # ì¸í„°ëŸ½íŠ¸ ë°¸ëŸ°ì‹± ìµœì í™”
    if command -v irqbalance >/dev/null 2>&1; then
        systemctl enable irqbalance
        systemctl start irqbalance
    fi
    
    echo "CPU performance optimized"
}

# ë””ìŠ¤í¬ I/O ìµœì í™”
optimize_disk_io() {
    echo "Optimizing disk I/O..."
    
    # SSDìš© ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
    for disk in /sys/block/sd*/queue/scheduler; do
        if [ -f "$disk" ]; then
            echo noop > "$disk" 2>/dev/null || echo none > "$disk" 2>/dev/null
        fi
    done
    
    # NVMeìš© ì„¤ì •
    for disk in /sys/block/nvme*/queue/scheduler; do
        if [ -f "$disk" ]; then
            echo none > "$disk" 2>/dev/null
        fi
    done
    
    # Read-ahead ì„¤ì •
    for disk in /sys/block/sd*/queue/read_ahead_kb; do
        if [ -f "$disk" ]; then
            echo 128 > "$disk"
        fi
    done
    
    echo "Disk I/O optimized"
}

optimize_kernel_parameters
configure_system_limits
optimize_cpu_performance
optimize_disk_io
```

### kubelet ì„±ëŠ¥ ìµœì í™”

```yaml
# kubelet-config-performance.yaml
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration

# ê¸°ë³¸ ì„¤ì •
authentication:
  webhook:
    enabled: true
  anonymous:
    enabled: false

authorization:
  mode: Webhook

# ì„±ëŠ¥ ìµœì í™” ì„¤ì •
maxPods: 250  # ë…¸ë“œë‹¹ ìµœëŒ€ Pod ìˆ˜ (ê¸°ë³¸ê°’: 110)

# ë¦¬ì†ŒìŠ¤ ì˜ˆì•½
systemReserved:
  cpu: "1000m"
  memory: "2Gi"
  ephemeral-storage: "10Gi"

kubeReserved:
  cpu: "500m"
  memory: "1Gi"
  ephemeral-storage: "5Gi"

# Eviction ì„ê³„ê°’ ìµœì í™”
evictionHard:
  memory.available: "500Mi"
  nodefs.available: "10%"
  nodefs.inodesFree: "5%"
  imagefs.available: "15%"

evictionSoft:
  memory.available: "1Gi"
  nodefs.available: "15%"
  nodefs.inodesFree: "10%"
  imagefs.available: "20%"

evictionSoftGracePeriod:
  memory.available: "2m"
  nodefs.available: "5m"
  nodefs.inodesFree: "5m"
  imagefs.available: "5m"

# ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ìµœì í™”
imageGCHighThresholdPercent: 85
imageGCLowThresholdPercent: 80

containerGCThreshold:
  minAge: 1m
  maxPerPodContainer: 2
  maxContainers: 240

# ë™ê¸°í™” ì£¼ê¸° ìµœì í™”
syncFrequency: 60s
nodeStatusUpdateFrequency: 10s
nodeStatusReportFrequency: 5m

# ë³¼ë¥¨ í”ŒëŸ¬ê·¸ì¸ ìµœì í™”
volumeStatsAggPeriod: 60s

# ë¡œê·¸ ì„¤ì •
logging:
  format: json

# ë„¤íŠ¸ì›Œí¬ ì„¤ì •
clusterDNS:
  - "10.96.0.10"
clusterDomain: "cluster.local"

# CPU ê´€ë¦¬ ì •ì±… (ê³ ì„±ëŠ¥ ì›Œí¬ë¡œë“œìš©)
cpuManagerPolicy: static
topologyManagerPolicy: single-numa-node

# ë©”ëª¨ë¦¬ ê´€ë¦¬ ì •ì±…
memoryManagerPolicy: Static

# ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ìµœì í™”
containerRuntimeEndpoint: "unix:///var/run/containerd/containerd.sock"
containerLogMaxSize: "50Mi"
containerLogMaxFiles: 5

# ì½ê¸° ì „ìš© í¬íŠ¸ ë¹„í™œì„±í™” (ë³´ì•ˆ)
readOnlyPort: 0

# í—¬ìŠ¤ì²´í¬ ìµœì í™”
streamingConnectionIdleTimeout: 4h
nodeStatusMaxImages: 50

# ê¸°íƒ€ ìµœì í™”
serializeImagePulls: false  # ë³‘ë ¬ ì´ë¯¸ì§€ í’€ í—ˆìš©
registryPullQPS: 10
registryBurst: 20
```

## ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™”

### CNI í”ŒëŸ¬ê·¸ì¸ ìµœì í™”

```yaml
# calico-performance-config.yaml
---
# Calico ì„±ëŠ¥ ìµœì í™” ì„¤ì •
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  calicoNetwork:
    bgp: Enabled
    hostPorts: Enabled
    multiInterfaceMode: None
    containerIPForwarding: Enabled
    ipPools:
    - blockSize: 26
      cidr: 10.244.0.0/16
      encapsulation: VXLAN
      natOutgoing: Enabled
      nodeSelector: all()
  
  # ì„±ëŠ¥ ìµœì í™”
  componentResources:
  - componentName: Node
    resourceRequirements:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
  - componentName: Typha
    resourceRequirements:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

---
# Felix ì„±ëŠ¥ íŠœë‹
apiVersion: projectcalico.org/v3
kind: FelixConfiguration
metadata:
  name: default
spec:
  # ë¡œê·¸ ë ˆë²¨ ì¡°ì •
  logSeverityScreen: Info
  
  # ì„±ëŠ¥ ê´€ë ¨ ì„¤ì •
  bpfEnabled: true  # eBPF í™œì„±í™” (ì§€ì›ë˜ëŠ” ì»¤ë„ì—ì„œ)
  bpfLogLevel: Off
  
  # iptables ìµœì í™”
  iptablesMarkMask: 0xffff0000
  iptablesPostWriteCheckIntervalSecs: 5
  iptablesRefreshInterval: 60s
  
  # ì—°ê²° ì¶”ì  ìµœì í™”
  genericXDPEnabled: true
  
  # ë¼ìš°íŒ… ìµœì í™”
  routeRefreshInterval: 60s
  interfaceRefreshInterval: 90s
  
  # ì›Œí¬í í¬ê¸° ì¡°ì •
  interfaceRefreshInterval: 90s
  routeRefreshInterval: 90s

---
# BGP ì„¤ì • ìµœì í™”
apiVersion: projectcalico.org/v3
kind: BGPConfiguration
metadata:
  name: default
spec:
  logSeverityScreen: Info
  asNumber: 64512
  serviceClusterIPs:
  - cidr: 10.96.0.0/12
  serviceExternalIPs:
  - cidr: 192.168.100.0/24
```

### ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ìµœì í™”

```bash
#!/bin/bash
# network-optimization.sh

# ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”
optimize_network_interfaces() {
    echo "Optimizing network interfaces..."
    
    # ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— ëŒ€í•´ ìµœì í™” ìˆ˜í–‰
    for interface in $(ip link show | grep -E '^[0-9]+:' | grep -v lo | awk -F': ' '{print $2}'); do
        echo "Optimizing interface: $interface"
        
        # ë§ ë²„í¼ í¬ê¸° ì¦ê°€
        ethtool -G $interface rx 4096 tx 4096 2>/dev/null || true
        
        # TCP Segmentation Offload í™œì„±í™”
        ethtool -K $interface tso on 2>/dev/null || true
        ethtool -K $interface gso on 2>/dev/null || true
        ethtool -K $interface gro on 2>/dev/null || true
        
        # Checksum offload í™œì„±í™”
        ethtool -K $interface tx-checksumming on 2>/dev/null || true
        ethtool -K $interface rx-checksumming on 2>/dev/null || true
        
        # Scatter-gather í™œì„±í™”
        ethtool -K $interface sg on 2>/dev/null || true
    done
    
    echo "Network interfaces optimized"
}

# iptables ì„±ëŠ¥ ìµœì í™”
optimize_iptables() {
    echo "Optimizing iptables..."
    
    # iptables ëª¨ë“ˆ ìµœì í™”
    modprobe nf_conntrack
    
    # ì—°ê²° ì¶”ì  í…Œì´ë¸” í¬ê¸° ì¦ê°€
    echo 1048576 > /proc/sys/net/netfilter/nf_conntrack_max
    echo 262144 > /proc/sys/net/netfilter/nf_conntrack_buckets
    
    # ì—°ê²° ì¶”ì  ì‹œê°„ ì´ˆê³¼ ìµœì í™”
    echo 600 > /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_established
    echo 120 > /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_time_wait
    
    # ì˜êµ¬ ì„¤ì •
    cat >> /etc/sysctl.d/99-netfilter.conf << 'EOF'
net.netfilter.nf_conntrack_max = 1048576
net.netfilter.nf_conntrack_buckets = 262144
net.netfilter.nf_conntrack_tcp_timeout_established = 600
net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120
EOF
    
    echo "iptables optimized"
}

# ë„¤íŠ¸ì›Œí¬ í ìµœì í™”
optimize_network_queues() {
    echo "Optimizing network queues..."
    
    # ë©€í‹°í ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”
    for interface in $(ip link show | grep -E '^[0-9]+:' | grep -v lo | awk -F': ' '{print $2}'); do
        # RSS (Receive Side Scaling) ìµœì í™”
        cpu_count=$(nproc)
        queue_count=$(ethtool -l $interface 2>/dev/null | grep -A1 "Current hardware settings" | tail -1 | awk '{print $2}' || echo 1)
        
        if [ "$queue_count" -gt 1 ]; then
            echo "Setting up RSS for $interface with $queue_count queues"
            ethtool -X $interface equal $queue_count 2>/dev/null || true
        fi
        
        # ì¸í„°ëŸ½íŠ¸ ì–´í”¼ë‹ˆí‹° ì„¤ì •
        interface_irqs=$(grep $interface /proc/interrupts | awk '{print $1}' | sed 's/:$//')
        cpu_id=0
        for irq in $interface_irqs; do
            echo $((1 << cpu_id)) > /proc/irq/$irq/smp_affinity 2>/dev/null || true
            cpu_id=$(((cpu_id + 1) % cpu_count))
        done
    done
    
    echo "Network queues optimized"
}

optimize_network_interfaces
optimize_iptables
optimize_network_queues
```

## ğŸ’¾ ìŠ¤í† ë¦¬ì§€ ì„±ëŠ¥ ìµœì í™”

### ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ìµœì í™”

```toml
# /etc/containerd/config.toml
version = 2

[grpc]
  tcp_address = ""
  tcp_tls_cert = ""
  tcp_tls_key = ""
  uid = 0
  gid = 0
  max_recv_message_size = 16777216
  max_send_message_size = 16777216

[debug]
  address = ""
  uid = 0
  gid = 0
  level = ""

[metrics]
  address = "127.0.0.1:1338"
  grpc_histogram = false

[cgroup]
  path = ""

[timeouts]
  "io.containerd.timeout.shim.cleanup" = "5s"
  "io.containerd.timeout.shim.load" = "5s"
  "io.containerd.timeout.shim.shutdown" = "3s"
  "io.containerd.timeout.task.state" = "2s"

[plugins]
  [plugins."io.containerd.gc.v1.scheduler"]
    pause_threshold = 0.02
    deletion_threshold = 0
    mutation_threshold = 100
    schedule_delay = "0s"
    startup_delay = "100ms"
    
  [plugins."io.containerd.grpc.v1.cri"]
    device_ownership_from_security_context = false
    disable_apparmor = false
    disable_cgroup = false
    disable_hugetlb_controller = true
    disable_proc_mount = false
    disable_tcp_service = true
    enable_selinux = false
    enable_tls_streaming = false
    max_concurrent_downloads = 10  # ë™ì‹œ ë‹¤ìš´ë¡œë“œ ì¦ê°€
    max_container_log_line_size = 16384
    restrict_oom_score_adj = false
    sandbox_image = "k8s.gcr.io/pause:3.7"
    selinux_category_range = 1024
    stats_collect_period = 10
    stream_idle_timeout = "4h0m0s"
    stream_server_address = "127.0.0.1"
    stream_server_port = "0"
    systemd_cgroup = true  # systemd cgroup ë“œë¼ì´ë²„ ì‚¬ìš©
    tolerate_missing_hugetlb_controller = true
    unset_seccomp_profile = ""

    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/opt/cni/bin"
      conf_dir = "/etc/cni/net.d"
      conf_template = ""
      max_conf_num = 1

    [plugins."io.containerd.grpc.v1.cri".containerd]
      default_runtime_name = "runc"
      no_pivot = false
      snapshotter = "overlayfs"
      
      # ì´ë¯¸ì§€ í’€ ìµœì í™”
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          runtime_type = "io.containerd.runc.v2"
          runtime_engine = ""
          runtime_root = ""
          privileged_without_host_devices = false
          base_runtime_spec = ""
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
            SystemdCgroup = true
            BinaryName = ""

    [plugins."io.containerd.grpc.v1.cri".image_decryption]
      key_model = ""

    [plugins."io.containerd.grpc.v1.cri".registry]
      [plugins."io.containerd.grpc.v1.cri".registry.mirrors]
        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
          endpoint = ["https://registry-1.docker.io"]

  [plugins."io.containerd.internal.v1.opt"]
    path = "/opt/containerd"

  [plugins."io.containerd.internal.v1.restart"]
    interval = "10s"

  [plugins."io.containerd.metadata.v1.bolt"]
    content_sharing_policy = "shared"

  [plugins."io.containerd.monitor.v1.cgroups"]
    no_prometheus = false

  [plugins."io.containerd.runtime.v1.linux"]
    no_shim = false
    runtime = "runc"
    runtime_root = ""
    shim = "containerd-shim"
    shim_debug = false

  [plugins."io.containerd.runtime.v2.task"]
    platforms = ["linux/amd64"]

  [plugins."io.containerd.service.v1.diff-service"]
    default = ["walking"]

  [plugins."io.containerd.snapshotter.v1.devmapper"]
    pool_name = ""
    root_path = ""
    base_image_size = ""
    async_remove = false
```

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ê³¼ ë¶„ì„

### ì¢…í•© ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# performance-monitoring.sh

# ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
collect_performance_metrics() {
    echo "=== Kubernetes Performance Metrics ==="
    echo "Timestamp: $(date)"
    echo
    
    # í´ëŸ¬ìŠ¤í„° ì „ì²´ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
    echo "=== Cluster Resource Usage ==="
    kubectl top nodes --sort-by=cpu
    echo
    
    # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
    echo "=== Top Resource Consuming Pods ==="
    kubectl top pods --all-namespaces --sort-by=cpu | head -20
    echo
    
    # API Server ì§€ì—°ì‹œê°„ í™•ì¸
    echo "=== API Server Latency ==="
    time kubectl get nodes >/dev/null
    echo
    
    # etcd ì„±ëŠ¥ ë©”íŠ¸ë¦­
    echo "=== etcd Performance ==="
    if command -v etcdctl >/dev/null; then
        ETCDCTL_API=3 etcdctl \
            --endpoints=https://127.0.0.1:2379 \
            --cacert=/etc/kubernetes/pki/etcd/ca.crt \
            --cert=/etc/kubernetes/pki/etcd/server.crt \
            --key=/etc/kubernetes/pki/etcd/server.key \
            endpoint status --write-out=table 2>/dev/null || echo "etcd not accessible"
    fi
    echo
    
    # ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ìƒíƒœ
    echo "=== System Resources ==="
    echo "Load Average: $(uptime | awk -F'load average:' '{print $2}')"
    echo "Memory Usage: $(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')"
    echo "Disk Usage:"
    df -h | grep -E '(Filesystem|/dev/)' | grep -v tmpfs
    echo
    
    # ë„¤íŠ¸ì›Œí¬ ìƒíƒœ
    echo "=== Network Statistics ==="
    ss -tuln | grep -E ':(6443|2379|2380|10250|10251|10252)' | wc -l | xargs echo "Active Kubernetes Connections:"
    
    # ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ìƒíƒœ
    echo "=== Container Runtime Status ==="
    systemctl is-active containerd
    crictl info | grep -E "(runtimeVersion|osType)"
}

# ì„±ëŠ¥ ë³‘ëª© ì§€ì  ë¶„ì„
analyze_performance_bottlenecks() {
    echo "=== Performance Bottleneck Analysis ==="
    
    # CPU ì‚¬ìš©ë¥ ì´ ë†’ì€ í”„ë¡œì„¸ìŠ¤
    echo "Top CPU consuming processes:"
    ps aux --sort=-%cpu | head -10
    echo
    
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ì€ í”„ë¡œì„¸ìŠ¤
    echo "Top Memory consuming processes:"
    ps aux --sort=-%mem | head -10
    echo
    
    # I/O ëŒ€ê¸° ì‹œê°„ í™•ì¸
    echo "I/O Wait Statistics:"
    iostat -x 1 1 | tail -n +4 2>/dev/null || echo "iostat not available"
    echo
    
    # ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ
    echo "Network Connection Statistics:"
    ss -s
    echo
    
    # ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹˜ í™•ì¸
    echo "Context Switches per second:"
    vmstat 1 2 | tail -1 | awk '{print "cs: " $12 ", in: " $11}'
}

# ì„±ëŠ¥ ê°œì„  ê¶Œì¥ì‚¬í•­ ìƒì„±
generate_performance_recommendations() {
    echo "=== Performance Recommendations ==="
    
    # CPU ì‚¬ìš©ë¥  ë¶„ì„
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | sed 's/%us,//')
    if (( $(echo "$cpu_usage > 80" | bc -l) )); then
        echo "âš ï¸  HIGH CPU USAGE ($cpu_usage%) detected"
        echo "   - Consider scaling out workloads"
        echo "   - Review CPU requests/limits"
        echo "   - Check for CPU-intensive processes"
    fi
    
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë¶„ì„
    mem_usage=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    if (( $(echo "$mem_usage > 80" | bc -l) )); then
        echo "âš ï¸  HIGH MEMORY USAGE ($mem_usage%) detected"
        echo "   - Consider adding more nodes"
        echo "   - Review memory requests/limits"
        echo "   - Check for memory leaks"
    fi
    
    # ë””ìŠ¤í¬ ì‚¬ìš©ë¥  ë¶„ì„
    disk_usage=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ "$disk_usage" -gt 85 ]; then
        echo "âš ï¸  HIGH DISK USAGE ($disk_usage%) detected"
        echo "   - Clean up old logs and images"
        echo "   - Consider adding storage"
        echo "   - Review data retention policies"
    fi
    
    # ë„¤íŠ¸ì›Œí¬ ë¶„ì„
    tcp_connections=$(ss -t | wc -l)
    if [ "$tcp_connections" -gt 10000 ]; then
        echo "âš ï¸  HIGH TCP CONNECTIONS ($tcp_connections) detected"
        echo "   - Review connection pooling"
        echo "   - Check for connection leaks"
        echo "   - Consider increasing connection limits"
    fi
}

# ì„±ëŠ¥ ë³´ê³ ì„œ ìƒì„±
generate_performance_report() {
    local report_file="/var/log/k8s-performance-$(date +%Y%m%d_%H%M%S).log"
    
    {
        collect_performance_metrics
        echo
        analyze_performance_bottlenecks
        echo
        generate_performance_recommendations
    } | tee "$report_file"
    
    echo "Performance report generated: $report_file"
}

case "${1:-collect}" in
    collect)
        collect_performance_metrics
        ;;
    analyze)
        analyze_performance_bottlenecks
        ;;
    recommend)
        generate_performance_recommendations
        ;;
    report)
        generate_performance_report
        ;;
    *)
        echo "Usage: $0 {collect|analyze|recommend|report}"
        exit 1
        ;;
esac
```

## ğŸšï¸ ì›Œí¬ë¡œë“œë³„ ì„±ëŠ¥ ìµœì í™”

### ë°ì´í„°ë² ì´ìŠ¤ ì›Œí¬ë¡œë“œ ìµœì í™”

```yaml
# database-performance-optimization.yaml
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-optimized
spec:
  serviceName: mysql
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      # ê³ ì„±ëŠ¥ ë…¸ë“œì— ìŠ¤ì¼€ì¤„ë§
      nodeSelector:
        performance-tier: high
        storage-type: ssd
      
      # ë¦¬ì†ŒìŠ¤ ìš”ì²­/ì œí•œ ìµœì í™”
      containers:
      - name: mysql
        image: mysql:8.0
        resources:
          requests:
            cpu: "2000m"
            memory: "4Gi"
          limits:
            cpu: "4000m"
            memory: "8Gi"
        
        # í™˜ê²½ ë³€ìˆ˜ ìµœì í™”
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: password
        
        # MySQL ì„¤ì • ìµœì í™”
        volumeMounts:
        - name: mysql-config
          mountPath: /etc/mysql/conf.d
        - name: mysql-data
          mountPath: /var/lib/mysql
        
        # ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸
        securityContext:
          runAsUser: 999
          runAsGroup: 999
          allowPrivilegeEscalation: false
          
      volumes:
      - name: mysql-config
        configMap:
          name: mysql-config
  
  volumeClaimTemplates:
  - metadata:
      name: mysql-data
    spec:
      accessModes: ["ReadWriteOnce"]
      storageClassName: local-ssd  # ê³ ì„±ëŠ¥ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤
      resources:
        requests:
          storage: 100Gi

---
# MySQL ì„±ëŠ¥ ìµœì í™” ì„¤ì •
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config
data:
  my.cnf: |
    [mysqld]
    # ê¸°ë³¸ ì„¤ì •
    bind-address = 0.0.0.0
    port = 3306
    
    # ì„±ëŠ¥ ìµœì í™”
    innodb_buffer_pool_size = 6G  # ì „ì²´ ë©”ëª¨ë¦¬ì˜ 75%
    innodb_log_file_size = 1G
    innodb_log_buffer_size = 64M
    innodb_flush_log_at_trx_commit = 2
    innodb_file_per_table = 1
    innodb_open_files = 4000
    
    # ì—°ê²° ìµœì í™”
    max_connections = 1000
    max_connect_errors = 10000
    wait_timeout = 300
    interactive_timeout = 300
    
    # ì¿¼ë¦¬ ìºì‹œ
    query_cache_type = 1
    query_cache_size = 256M
    query_cache_limit = 2M
    
    # í…Œì´ë¸” ìºì‹œ
    table_open_cache = 4000
    table_definition_cache = 2000
    
    # ìŠ¤ë ˆë“œ ì„¤ì •
    thread_cache_size = 256
    thread_stack = 256K
    
    # ë„¤íŠ¸ì›Œí¬ ìµœì í™”
    max_allowed_packet = 128M
    net_buffer_length = 32K
```

### ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœì í™”

```yaml
# web-app-performance-optimization.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app-optimized
spec:
  replicas: 6
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
    spec:
      # íŒŒë“œ ë¶„ì‚° ë°°ì¹˜
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - web-app
              topologyKey: kubernetes.io/hostname
      
      containers:
      - name: web-app
        image: nginx:1.21-alpine
        
        # ë¦¬ì†ŒìŠ¤ ìµœì í™”
        resources:
          requests:
            cpu: "100m"
            memory: "128Mi"
          limits:
            cpu: "500m"
            memory: "512Mi"
        
        # í¬íŠ¸ ì„¤ì •
        ports:
        - containerPort: 8080
          name: http
        
        # í—¬ìŠ¤ì²´í¬ ìµœì í™”
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 15
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
          
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 2
          
        # í™˜ê²½ë³„ ì„¤ì •
        env:
        - name: NGINX_WORKER_PROCESSES
          value: "auto"
        - name: NGINX_WORKER_CONNECTIONS
          value: "1024"
        
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/conf.d
        - name: tmp
          mountPath: /tmp
        - name: cache
          mountPath: /var/cache/nginx
        - name: run
          mountPath: /var/run
          
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-config
      - name: tmp
        emptyDir: {}
      - name: cache
        emptyDir: {}
      - name: run
        emptyDir: {}

---
# HPA ì„¤ì •
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: web-app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: web-app-optimized
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
```

## ğŸ“‹ ì„±ëŠ¥ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

### í´ëŸ¬ìŠ¤í„° ë ˆë²¨
- [ ] etcd ì••ì¶• ë° ì¡°ê° ëª¨ìŒ ì •ê¸° ì‹¤í–‰
- [ ] API Server ë¦¬ì†ŒìŠ¤ ì œí•œ ì ì ˆíˆ ì„¤ì •
- [ ] Controller Manager/Scheduler ìµœì í™”
- [ ] ë¶ˆí•„ìš”í•œ ì• ë“œì˜¨ ì œê±°

### ë…¸ë“œ ë ˆë²¨
- [ ] ì»¤ë„ íŒŒë¼ë¯¸í„° ìµœì í™”
- [ ] CPU ê±°ë²„ë„ˆ performance ëª¨ë“œ ì„¤ì •
- [ ] ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì˜ˆì•½ ì„¤ì •
- [ ] ë””ìŠ¤í¬ I/O ìŠ¤ì¼€ì¤„ëŸ¬ ìµœì í™”
- [ ] ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨
- [ ] ì ì ˆí•œ ë¦¬ì†ŒìŠ¤ ìš”ì²­/ì œí•œ ì„¤ì •
- [ ] HPA/VPA ì„¤ì •
- [ ] íŒŒë“œ ì–´í”¼ë‹ˆí‹°/ì•ˆí‹°ì–´í”¼ë‹ˆí‹° ì ìš©
- [ ] í—¬ìŠ¤ì²´í¬ ìµœì í™”
- [ ] ì´ë¯¸ì§€ í¬ê¸° ìµœì†Œí™”

### ìŠ¤í† ë¦¬ì§€ ë ˆë²¨
- [ ] ì›Œí¬ë¡œë“œì— ì í•©í•œ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ì„ íƒ
- [ ] ê³ ì„±ëŠ¥ ì›Œí¬ë¡œë“œì— Local SSD ì‚¬ìš©
- [ ] ìŠ¤í† ë¦¬ì§€ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- [ ] ë°±ì—… ì „ëµ ìµœì í™”

---

> ğŸ’¡ **ì‹¤ì „ ê²½í—˜**: ì„±ëŠ¥ ìµœì í™”ëŠ” ì ì§„ì ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”. í•œ ë²ˆì— ëª¨ë“  ì„¤ì •ì„ ë³€ê²½í•˜ë©´ ë¬¸ì œì˜ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤. ê° ë³€ê²½ì‚¬í•­ì˜ íš¨ê³¼ë¥¼ ì¸¡ì •í•˜ê³  ê²€ì¦í•œ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. íŠ¹íˆ ì˜¨í”„ë ˜ í™˜ê²½ì—ì„œëŠ” í•˜ë“œì›¨ì–´ íŠ¹ì„±ì„ ì˜ ì´í•´í•˜ê³  ê·¸ì— ë§ëŠ” ìµœì í™”ë¥¼ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

íƒœê·¸: #performance #tuning #optimization #monitoring #onprem
