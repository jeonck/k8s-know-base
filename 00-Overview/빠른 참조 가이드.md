# ğŸ”§ Kubernetes ë¹ ë¥¸ ì°¸ì¡° ê°€ì´ë“œ

> ì¼ìƒ ìš´ì˜ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ì™€ íŒ ëª¨ìŒ

## ğŸ“‹ í•„ìˆ˜ ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

### ê¸°ë³¸ ì •ë³´ í™•ì¸

```bash
# í´ëŸ¬ìŠ¤í„° ì •ë³´
kubectl cluster-info
kubectl version --short
kubectl config current-context

# ë…¸ë“œ ìƒíƒœ
kubectl get nodes -o wide
kubectl describe node <node-name>
kubectl top nodes  # metrics-server í•„ìš”

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤
kubectl get namespaces
kubectl config set-context --current --namespace=<namespace>
```

### Pod ê´€ë¦¬

```bash
# Pod ì¡°íšŒ
kubectl get pods                           # í˜„ì¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
kubectl get pods --all-namespaces         # ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤
kubectl get pods -o wide                  # ë…¸ë“œ ì •ë³´ í¬í•¨
kubectl get pods --show-labels            # ë¼ë²¨ í‘œì‹œ
kubectl get pods --field-selector=status.phase=Running

# Pod ìƒì„¸ ì •ë³´
kubectl describe pod <pod-name>
kubectl get pod <pod-name> -o yaml
kubectl get pod <pod-name> -o json

# Pod ë¡œê·¸
kubectl logs <pod-name>                    # í˜„ì¬ ë¡œê·¸
kubectl logs <pod-name> --previous        # ì´ì „ ì»¨í…Œì´ë„ˆ ë¡œê·¸
kubectl logs <pod-name> -f                # ì‹¤ì‹œê°„ ë¡œê·¸
kubectl logs <pod-name> --tail=50         # ë§ˆì§€ë§‰ 50ì¤„
kubectl logs <pod-name> --since=1h        # ìµœê·¼ 1ì‹œê°„

# Pod ì‹¤í–‰/ì‚­ì œ
kubectl run nginx --image=nginx           # Pod ìƒì„±
kubectl exec -it <pod-name> -- /bin/bash  # Pod ì ‘ì†
kubectl delete pod <pod-name>             # Pod ì‚­ì œ
kubectl delete pod <pod-name> --force --grace-period=0  # ê°•ì œ ì‚­ì œ
```

### Deployment ê´€ë¦¬

```bash
# Deployment ì¡°íšŒ
kubectl get deployments
kubectl describe deployment <deployment-name>
kubectl rollout status deployment/<deployment-name>

# Deployment ìŠ¤ì¼€ì¼ë§
kubectl scale deployment <deployment-name> --replicas=5

# ë¡¤ë§ ì—…ë°ì´íŠ¸
kubectl set image deployment/<deployment-name> container=image:tag
kubectl rollout restart deployment/<deployment-name>

# ë¡¤ë°±
kubectl rollout history deployment/<deployment-name>
kubectl rollout undo deployment/<deployment-name>
kubectl rollout undo deployment/<deployment-name> --to-revision=2
```

### Serviceì™€ Ingress

```bash
# Service ì¡°íšŒ
kubectl get services
kubectl get svc -o wide
kubectl describe svc <service-name>

# Endpoints í™•ì¸
kubectl get endpoints <service-name>

# Ingress ì¡°íšŒ
kubectl get ingress
kubectl describe ingress <ingress-name>
```

### ConfigMapê³¼ Secret

```bash
# ConfigMap
kubectl get configmaps
kubectl describe configmap <configmap-name>
kubectl create configmap <name> --from-file=<file>
kubectl create configmap <name> --from-literal=key=value

# Secret
kubectl get secrets
kubectl describe secret <secret-name>
kubectl create secret generic <name> --from-literal=key=value
kubectl get secret <secret-name> -o jsonpath='{.data.key}' | base64 -d
```

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

```bash
# ë…¸ë“œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top nodes
kubectl top nodes --sort-by=cpu
kubectl top nodes --sort-by=memory

# Pod ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top pods
kubectl top pods --all-namespaces
kubectl top pods --sort-by=cpu
kubectl top pods --sort-by=memory
```

## ğŸš¨ ê¸´ê¸‰ ìƒí™© ëŒ€ì‘ ëª…ë ¹ì–´

### í´ëŸ¬ìŠ¤í„° ìƒíƒœ ì§„ë‹¨

```bash
# í•œ ë²ˆì— ì „ì²´ ìƒíƒœ í™•ì¸
kubectl get nodes,pods,svc,ing --all-namespaces

# ë¬¸ì œê°€ ìˆëŠ” Pod ì°¾ê¸°
kubectl get pods --all-namespaces --field-selector=status.phase!=Running
kubectl get pods --all-namespaces | grep -v Running | grep -v Completed

# ìµœê·¼ ì´ë²¤íŠ¸ í™•ì¸
kubectl get events --sort-by='.lastTimestamp' --all-namespaces
kubectl get events --field-selector type=Warning --all-namespaces

# ì‹œìŠ¤í…œ Pod ìƒíƒœ
kubectl get pods -n kube-system
kubectl get pods -n kube-system | grep -v Running
```

### ë…¸ë“œ ë¬¸ì œ í•´ê²°

```bash
# ë¬¸ì œ ë…¸ë“œ ì°¾ê¸°
kubectl get nodes | grep -v Ready

# ë…¸ë“œ ìƒì„¸ ì •ë³´
kubectl describe node <node-name>

# ë…¸ë“œ ë“œë ˆì¸ (ìœ ì§€ë³´ìˆ˜ìš©)
kubectl drain <node-name> --ignore-daemonsets --delete-emptydir-data

# ë…¸ë“œ ìŠ¤ì¼€ì¤„ë§ ì¬ê°œ
kubectl uncordon <node-name>

# ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Pod í™•ì¸
kubectl get pods --all-namespaces --field-selector spec.nodeName=<node-name>
```

### Pod íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

```bash
# ì‹¤íŒ¨í•œ Pod ë¶„ì„
kubectl describe pod <pod-name>
kubectl logs <pod-name> --previous

# Pod ì´ë²¤íŠ¸ë§Œ í™•ì¸
kubectl get events --field-selector involvedObject.name=<pod-name>

# Pod ë‚´ë¶€ ë””ë²„ê¹…
kubectl exec -it <pod-name> -- /bin/sh
kubectl exec -it <pod-name> -c <container-name> -- /bin/sh

# ì„ì‹œ ë””ë²„ê·¸ Pod ìƒì„±
kubectl run debug --image=busybox --rm -it --restart=Never -- /bin/sh
```

## ğŸ” ê³ ê¸‰ ì¿¼ë¦¬ì™€ í•„í„°ë§

### JSONPath í™œìš©

```bash
# íŠ¹ì • í•„ë“œë§Œ ì¶”ì¶œ
kubectl get pods -o jsonpath='{.items[*].metadata.name}'
kubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'
kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="InternalIP")].address}'

# ì‚¬ìš©ì ì •ì˜ ì»¬ëŸ¼ìœ¼ë¡œ ì¡°íšŒ
kubectl get pods -o custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName
kubectl get pv -o custom-columns=NAME:.metadata.name,CAPACITY:.spec.capacity.storage,STATUS:.status.phase
```

### ë¼ë²¨ê³¼ ì…€ë ‰í„°

```bash
# ë¼ë²¨ ê¸°ë°˜ í•„í„°ë§
kubectl get pods -l app=nginx
kubectl get pods -l environment=production,tier=frontend
kubectl get pods -l 'environment in (production,staging)'

# ë¼ë²¨ ì¶”ê°€/ì œê±°
kubectl label pod <pod-name> key=value
kubectl label pod <pod-name> key-        # ë¼ë²¨ ì œê±°
kubectl label node <node-name> key=value
```

### ì–´ë…¸í…Œì´ì…˜ ê´€ë¦¬

```bash
# ì–´ë…¸í…Œì´ì…˜ ì¡°íšŒ
kubectl get pod <pod-name> -o jsonpath='{.metadata.annotations}'

# ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
kubectl annotate pod <pod-name> key=value
kubectl annotate pod <pod-name> key-     # ì–´ë…¸í…Œì´ì…˜ ì œê±°
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ê³¼ ë””ë²„ê¹…

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```bash
# ë¦¬ì†ŒìŠ¤ ìš”ì²­/ì œí•œ í™•ì¸
kubectl describe nodes | grep -E "Name:|Allocated resources:"
kubectl get pods -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.spec.containers[0].resources}{"\n"}{end}'

# ë„¤íŠ¸ì›Œí¬ ì •ì±… í™•ì¸
kubectl get networkpolicy --all-namespaces
kubectl describe networkpolicy <policy-name>

# RBAC ê¶Œí•œ í™•ì¸
kubectl auth can-i <verb> <resource> --as=<user>
kubectl get rolebindings,clusterrolebindings --all-namespaces
```

### ì„±ëŠ¥ ë¶„ì„

```bash
# API ì„œë²„ ì„±ëŠ¥
kubectl get --raw /metrics | grep apiserver

# etcd ìƒíƒœ (ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ)
kubectl exec -n kube-system <etcd-pod> -- etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key \
  endpoint health
```

## ğŸ”§ ìœ ìš©í•œ ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸

### ì›ë¼ì´ë„ˆ ëª…ë ¹ì–´ë“¤

```bash
# ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì¡°íšŒ
kubectl get all --all-namespaces

# ì‹¤íŒ¨í•œ Podë“¤ë§Œ ì‚­ì œ
kubectl delete pods --field-selector=status.phase=Failed --all-namespaces

# ì˜¤ë˜ëœ ReplicaSet ì •ë¦¬
kubectl get rs --all-namespaces | awk '$3+$4+$5 == 0 { print $1, $2 }' | xargs -n 2 kubectl delete rs -n

# ë…¸ë“œë³„ Pod ê°œìˆ˜ í™•ì¸
kubectl get pods --all-namespaces -o json | jq '.items | group_by(.spec.nodeName) | map({node: .[0].spec.nodeName, count: length})'

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top pods --all-namespaces | awk 'NR>1 {cpu[$1]+=$2; mem[$1]+=$3} END {for (ns in cpu) printf "%-20s CPU: %4s Memory: %s\n", ns, cpu[ns], mem[ns]}'
```

### ë¹ ë¥¸ ë””ë²„ê¹… ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# quick-debug.sh

echo "=== Cluster Quick Health Check ==="
echo "Nodes:"
kubectl get nodes --no-headers | awk '{print $1, $2}'

echo -e "\nFailed Pods:"
kubectl get pods --all-namespaces --field-selector=status.phase!=Running,status.phase!=Succeeded --no-headers | wc -l

echo -e "\nRecent Events:"
kubectl get events --sort-by='.lastTimestamp' --all-namespaces | tail -5

echo -e "\nTop CPU Pods:"
kubectl top pods --all-namespaces --sort-by=cpu 2>/dev/null | head -5 || echo "Metrics server not available"

echo -e "\nTop Memory Pods:"
kubectl top pods --all-namespaces --sort-by=memory 2>/dev/null | head -5 || echo "Metrics server not available"
```

## ğŸ” ë³´ì•ˆ ê´€ë ¨ ëª…ë ¹ì–´

### ì¸ì¦ì„œ ê´€ë¦¬

```bash
# ì¸ì¦ì„œ ë§Œë£Œì¼ í™•ì¸
kubeadm certs check-expiration

# ì¸ì¦ì„œ ê°±ì‹ 
kubeadm certs renew all

# ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ í† í° í™•ì¸
kubectl get serviceaccounts
kubectl describe serviceaccount <sa-name>
kubectl get secrets | grep <sa-name>
```

### ê¶Œí•œ ê´€ë¦¬

```bash
# í˜„ì¬ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
kubectl auth whoami
kubectl auth can-i '*' '*'
kubectl auth can-i list pods

# íŠ¹ì • ì‚¬ìš©ìì˜ ê¶Œí•œ í™•ì¸
kubectl auth can-i list pods --as=<username>
kubectl auth can-i '*' '*' --as=system:serviceaccount:default:default

# Roleê³¼ RoleBinding í™•ì¸
kubectl get roles,rolebindings --all-namespaces
kubectl describe rolebinding <rolebinding-name>
```

## ğŸ“ íŒŒì¼ê³¼ ì„¤ì • ê´€ë¦¬

### ë°±ì—… ëª…ë ¹ì–´

```bash
# ì „ì²´ ë¦¬ì†ŒìŠ¤ ë°±ì—…
kubectl get all --all-namespaces -o yaml > cluster-backup.yaml

# íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë°±ì—…
kubectl get all -n <namespace> -o yaml > namespace-backup.yaml

# ConfigMapê³¼ Secret ë°±ì—…
kubectl get configmaps --all-namespaces -o yaml > configmaps-backup.yaml
kubectl get secrets --all-namespaces -o yaml > secrets-backup.yaml

# etcd ë°±ì—… (ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ)
ETCDCTL_API=3 etcdctl snapshot save /tmp/etcd-snapshot.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key
```

### ì„¤ì • ì ìš©

```bash
# íŒŒì¼ì—ì„œ ë¦¬ì†ŒìŠ¤ ìƒì„±/ì—…ë°ì´íŠ¸
kubectl apply -f <file.yaml>
kubectl apply -f <directory>/

# ë³€ê²½ì‚¬í•­ ë¯¸ë¦¬ë³´ê¸°
kubectl diff -f <file.yaml>

# ë¦¬ì†ŒìŠ¤ ì‚­ì œ
kubectl delete -f <file.yaml>

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ í•¨ê»˜ ì ìš©
kubectl apply -f <file.yaml> -n <namespace>
```

---

> ğŸ’¡ **í”„ë¡œ íŒ**:
> - `alias k=kubectl`ë¡œ íƒ€ì´í•‘ ì‹œê°„ ë‹¨ì¶•
> - `kubectl completion bash` ìë™ì™„ì„± ì„¤ì •
> - `watch kubectl get pods`ë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
> - `kubectl explain <resource>`ë¡œ ë¦¬ì†ŒìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¸
> - ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ë“¤ì€ ìŠ¤í¬ë¦½íŠ¸ë‚˜ aliasë¡œ ë§Œë“¤ì–´ ë‘ê¸°

**ê´€ë ¨ ë¬¸ì„œ**: [[09-Operations/íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ]] | [[Scripts/í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸]] | [[09-Operations/ì¼ìƒ ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸]]