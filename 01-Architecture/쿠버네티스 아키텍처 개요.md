# 쿠버네티스 아키텍처 개요

## 🏗️ 전체 아키텍처

쿠버네티스는 **마스터-워커 아키텍처**를 기반으로 하는 분산 시스템입니다.

```
┌─────────────────────────────────────────────────────┐
│                 Control Plane                       │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│  │  API Server │ │    etcd     │ │ Scheduler   │   │
│  └─────────────┘ └─────────────┘ └─────────────┘   │
│  ┌─────────────┐ ┌─────────────┐                   │
│  │Controller   │ │Cloud Control│                   │
│  │Manager      │ │Manager      │                   │
│  └─────────────┘ └─────────────┘                   │
└─────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
┌───────▼──────┐ ┌────────▼──────┐ ┌────────▼──────┐
│ Worker Node 1│ │ Worker Node 2 │ │ Worker Node N │
│              │ │               │ │               │
│ ┌──────────┐ │ │ ┌──────────┐  │ │ ┌──────────┐  │
│ │ kubelet  │ │ │ │ kubelet  │  │ │ │ kubelet  │  │
│ └──────────┘ │ │ └──────────┘  │ │ └──────────┘  │
│ ┌──────────┐ │ │ ┌──────────┐  │ │ ┌──────────┐  │
│ │kube-proxy│ │ │ │kube-proxy│  │ │ │kube-proxy│  │
│ └──────────┘ │ │ └──────────┘  │ │ └──────────┘  │
│ ┌──────────┐ │ │ ┌──────────┐  │ │ ┌──────────┐  │
│ │Container │ │ │ │Container │  │ │ │Container │  │
│ │Runtime   │ │ │ │Runtime   │  │ │ │Runtime   │  │
│ └──────────┘ │ │ └──────────┘  │ │ └──────────┘  │
└──────────────┘ └───────────────┘ └───────────────┘
```

## 🎯 핵심 개념

### 선언적 API (Declarative API)
- **현재 상태 vs 원하는 상태**: 쿠버네티스는 현재 상태를 원하는 상태로 수렴시킵니다
- **수렴 루프**: 컨트롤러들이 지속적으로 상태를 확인하고 조정합니다

### 마이크로서비스 아키텍처
각 컴포넌트는 독립적으로 실행되며 API를 통해 통신합니다.

## 🔧 컨트롤 플레인 구성요소

### API Server
- **역할**: 모든 API 요청의 진입점
- **책임**: 인증, 인가, 검증, etcd와의 통신
- **온프렘 고려사항**: 
  - 고가용성을 위한 다중 인스턴스 필요
  - 로드밸런서 필수

### etcd
- **역할**: 클러스터의 모든 상태 정보 저장
- **특징**: 분산형 key-value 저장소
- **온프렘 실전 팁**:
  - **백업**: 매일 자동 백업 설정 필수
  - **스토리지**: SSD 사용 권장 (IOPS 중요)
  - **네트워크**: 저지연 네트워크 필요

### Scheduler
- **역할**: Pod를 적절한 노드에 배치
- **고려요소**: 리소스, 정책, 제약사항
- **실전 경험**:
  - 노드 라벨링 전략이 중요
  - 커스텀 스케줄러 고려 시점 파악

### Controller Manager
- **역할**: 다양한 컨트롤러들을 실행
- **주요 컨트롤러**:
  - Node Controller
  - Replication Controller
  - Endpoints Controller
  - Service Account & Token Controllers

## 🖥️ 워커 노드 구성요소

### kubelet
- **역할**: 노드의 Pod 생명주기 관리
- **책임**: 
  - Pod 스펙 실행
  - 컨테이너 런타임과 통신
  - 노드 상태 보고

### kube-proxy
- **역할**: 네트워크 프록시
- **모드**:
  - iptables (기본)
  - IPVS (고성능)
  - userspace (레거시)

### Container Runtime
- **지원 런타임**:
  - containerd (권장)
  - CRI-O
  - Docker (deprecated)

## 🌐 네트워킹 아키텍처

### 클러스터 네트워킹 요구사항
1. **Pod-to-Pod**: 모든 Pod는 NAT 없이 통신
2. **Node-to-Pod**: 노드는 모든 Pod와 통신 가능
3. **Pod-to-Service**: 서비스 디스커버리와 로드밸런싱

### CNI (Container Network Interface)
온프렘 환경에서 추천하는 CNI:
- **Calico**: 성능과 정책 기능
- **Flannel**: 간단한 설정
- **Cilium**: eBPF 기반 고성능

## 💾 스토리지 아키텍처

### 스토리지 추상화 계층
```
Application
    ↓
PersistentVolumeClaim (PVC)
    ↓
PersistentVolume (PV)
    ↓
StorageClass
    ↓
Physical Storage
```

## 🔒 보안 아키텍처

### 인증과 인가 흐름
```
Client → API Server
           ↓
       Authentication
           ↓ 
       Authorization (RBAC)
           ↓
       Admission Controllers
           ↓
       etcd
```

## 📊 온프렘 아키텍처 고려사항

### 고가용성 설계
```
┌─────────────────────────────────────┐
│         Load Balancer               │
│    (HAProxy/Nginx/F5/etc)          │
└─────────────┬───────────────────────┘
              │
    ┌─────────┼─────────┐
    │         │         │
┌───▼───┐ ┌──▼────┐ ┌──▼────┐
│Master1│ │Master2│ │Master3│
│       │ │       │ │       │
│ etcd  │ │ etcd  │ │ etcd  │
└───────┘ └───────┘ └───────┘
```

### 네트워크 설계
- **관리 네트워크**: 쿠버네티스 API 통신
- **데이터 네트워크**: Pod 간 통신
- **스토리지 네트워크**: 스토리지 전용

### 하드웨어 요구사항

#### 마스터 노드 (최소)
- **CPU**: 4 core
- **RAM**: 8GB
- **Storage**: 100GB SSD
- **Network**: 1Gbps

#### 워커 노드 (권장)
- **CPU**: 8+ core
- **RAM**: 16GB+
- **Storage**: 200GB+ SSD
- **Network**: 1Gbps+

## 🚨 실전 운영 팁

### 🔧 성능 고려사항
1. **etcd 성능**: 
   - 전용 디스크 사용
   - 백엔드 배치 간격 조정
2. **API Server**:
   - 요청 제한 설정
   - 감사 로그 최적화

### 🛡️ 보안 강화
1. **네트워크 분리**: 컨트롤 플레인과 워커 노드 분리
2. **인증서 관리**: 정기적인 인증서 로테이션
3. **방화벽 설정**: 필요한 포트만 개방

### 📈 확장성 계획
- **수직 확장**: 노드 리소스 증설
- **수평 확장**: 노드 수 증가
- **자동 확장**: HPA, VPA, CA 활용

## 🔗 관련 문서

- [[01-Architecture/컨트롤 플레인 구성요소|컨트롤 플레인 구성요소]]
- [[01-Architecture/워커 노드 구성요소|워커 노드 구성요소]]
- [[01-Architecture/네트워킹 모델|네트워킹 모델]]
- [[02-Installation/고가용성 클러스터 구성|고가용성 클러스터 구성]]

---

> 💡 **실전 경험**: 온프렘에서는 클라우드와 달리 인프라 관리가 직접 필요합니다. 특히 네트워킹과 스토리지 설계가 성공의 핵심입니다.

태그: #architecture #overview #onprem